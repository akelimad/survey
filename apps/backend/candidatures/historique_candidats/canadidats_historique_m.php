     <br/><h1> HISTORIQUE DES CANDIDATS </h1> <div class="texte"><form action="" method="post">         <input name="email" id="email" type="hidden" />     </form>     <?php	                /////////////////////////////////////////////traitement filtrage///////////////////////////////////////////////// if(isset($_POST["motcle"]) and $_POST["motcle"]!='')  $_SESSION["ch_motcle"]=$_POST["motcle"];if(isset($_POST["pertinence"]) and $_POST["pertinence"]!='')  $_SESSION["ch_pertinence"]=$_POST["pertinence"];if(isset($_POST["secteur"]) and $_POST["secteur"]!='')  $_SESSION["ch_secteur"]=$_POST["secteur"];if(isset($_POST["fraicheur"]) and $_POST["fraicheur"]!='')  $_SESSION["ch_fraicheur"]=$_POST["fraicheur"];if(isset($_POST["type_formation"]) and $_POST["type_formation"]!='')  $_SESSION["ch_type_formation"]=$_POST["type_formation"];if(isset($_POST["exp"]) and $_POST["exp"]!='')  $_SESSION["ch_exp"]=$_POST["exp"];if(isset($_POST["etablissement"]) and $_POST["etablissement"]!='')  $_SESSION["ch_etablissement"]=$_POST["etablissement"];if(isset($_POST["pays"]) and $_POST["pays"]!='')  $_SESSION["ch_pays"]=$_POST["pays"];if(isset($_POST["formation"]) and $_POST["formation"]!='')  $_SESSION["ch_formation"]=$_POST["formation"];if(isset($_POST["situation"]) and $_POST["situation"]!='')  $_SESSION["ch_situation"]=$_POST["situation"];if(isset($_POST["ref"]) and $_POST["ref"]!='')  $_SESSION["ch_ref"]=$_POST["ref"];if(isset($_POST["salaire"]) and $_POST["salaire"]!='')  $_SESSION["ch_salaire"]=$_POST["salaire"];if(isset($_POST["dispo"]) and $_POST["dispo"]!='')  $_SESSION["ch_dispo"]=$_POST["dispo"];if(isset($_POST["datecv"]) and $_POST["datecv"]!='')  $_SESSION["ch_datecv"]=$_POST["datecv"];      	  	                           if(isset($_POST['actualiser']))	{				$_POST['motcle']="";				$_SESSION["ch_motcle"]="";				$_POST['fonction']="";				$_SESSION["ch_fonction"]="";				$_POST['pays']="";				$_SESSION["ch_pays"]="";				$_POST['exp']="";				$_SESSION["ch_exp"]="";				$_POST['secteur']="";				$_SESSION["ch_secteur"]="";				$_POST['pertinence']=""; 				$_SESSION["ch_pertinence"]=""; 				$_POST['fraicheur']="";				$_SESSION["ch_fraicheur"]="";				$_POST['situation']="";				$_SESSION["ch_situation"]="";				$_POST['etablissement']="";				$_SESSION["ch_etablissement"]="";				$_POST['type_formation']="";				$_SESSION["ch_type_formation"]="";				$_POST['formation']="";				$_SESSION["ch_formation"]="";				$_POST['ref']="";				$_SESSION["ch_ref"]="";   				 $_POST['salaire'] = "";				$_SESSION["ch_salaire"]=""; 				 $_POST['dispo'] = "";				$_SESSION["ch_dispo"]=""; 				 $_POST['datecv'] = "";				$_SESSION["ch_datecv"]=""; 				}        if(isset($_POST['select']))  {    $affected = 0;      if(isset($_POST['email_tt'])){        $result_unique =  array_keys(array_flip($_POST['select'])); 		for ($i = 0; $i < count($result_unique); $i++){					if($i != 0) $c=',';				$id_list .=$c.$result_unique[$i]; 			} ?><script>    $(document).ready(function(){		        $('#form_pop_dossier12').submit(function(){            var variable = $(this).serialize();            $.ajax({                type: 'POST',                url: 'dossier_list.php',                data:  variable,                success: function(msg1){                    if(msg1=="vide")                    {                        $('#msg1').empty();                        $('#msg1').append('<p style=color:#CC0000>Choisissez un dossier SVP</p>');                    }                    else                    {			                        if(msg1=="ok")                        {                            $('#msg1').empty();	                            $('#msg1').append('<h3>Affectation au dossier avec succès</h3>');                            $("#repertoire_dossier").fadeIn("slow");                        }                        else                        {                            if(msg1=="ok")                            {                                $('#msg1').empty();	                                $('#msg1').append('<h3>Affectation au dossier avec succès</h3>');                                $("#repertoire_dossier").fadeIn("slow");                            }                            else                            {                                $('#msg1').empty();                                $('#msg1').append(msg1);                            }                        }                    }				                }            });            return false;        });        $("#fermer1").click(function(){			document.getElementById('repertoire_dossier').style.visibility = 'hidden';             location.reload();        });		    });</script>                                    <div id="repertoire0">                    <div id="fils">                     <div id="fade"></div>        <div class="popup_block_dossier" style="width: 560px; z-index: 999; top: 10%; left: 25%;">            <div class="titleBar_dossier">                <div class="title_dossier">Formulaire d'affectation au dossier </div>                <a href="./?a=2&b=24" id="fermer2">                <div class="close_dossier" style="cursor: pointer;">close</div></a>            </div>            <div id="content_dossier" class="content_dossier" style="height: 180px;">                <form action="" id="form_pop_dossier12" method="post">                    <table border="0" cellspacing="0" cellpadding="2" align="center">                        <tr>                            <td colspan="2">                                <div id="msg1"></div>                            </td>                        </tr>                        <tr>                            <td width="38%"><b>Id sélectionnés : </b><?php echo $id_list;  ?></td>                            <td id="champ_email1"></td>                            <td id="id_candidat1"><input type="hidden" value="<?php echo $id_list;  ?>" name="id_list" /></td>                        </tr>                        <tr>                            <td colspan="2">                                <div class="subscription" style="margin: 10px 0pt;">                                    <h1>Affectation au dossier  </h1>                                </div>                            </td>                        </tr>                                                                        <tr>                            <td width="35%"><b>Nom du dossier  </b></td>                            <td width="75%">                                <select name="dossier" required>                   <option value=""></option>                  <?php     $req_ci = mysql_query( "SELECT * FROM dossier");                          while ( $ci = mysql_fetch_array( $req_ci ) ) {                                      $ds_nom = $ci['nom_dossier'];  $ds_id = $ci['id_dossier'];                                                  echo '<option value="'.$ds_id.'">'.$ds_nom.'</option>';                   }                     ?>                  </select>                            </td>                        </tr>                        <tr>                            <td colspan="2">                                <div class="ligneBleu"></div>                                </div>                            </td>                        </tr>                        <tr>                            <td>                                <input name="envoi" type="submit" value="Valider" style="width:170px" />                            </td>                             <td>                                <input name="" type="reset" style="width:170px"/>                            </td>                        </tr>                               </table>                </form>            </div>        </div>                  </div>                  </div>  <?php     }            if(isset($_POST['archive'])){      for ($i = 0; $i < count($_POST["select"]); $i++){         mysql_query("Update candidature SET status = 'Archivée' where id_candidature = '".$_POST["select"][$i]."'");        $select = mysql_query("select id_candidat from candidature where id_candidature = '".$_POST["select"][$i]."'");        $rows = mysql_fetch_array($select);        $id_candidat = $rows['id_candidat'];                $select2 = mysql_query("SELECT id_cv FROM cv WHERE  actif=1 AND   principal=1 AND  candidats_id = '".$id_candidat."'");        $rows2 = mysql_fetch_array($select2);        $id  = $rows2['id_cv'];        $insert = mysql_query("INSERT INTO archive_cvs values ('','$id_candidat', '$id')");        $affected += mysql_affected_rows();      }      if($affected >= 0)        echo $affected.' Candidature(s) archivée(s).';    }    if(isset($_POST['delete'])){      $deleted = 0; $affected = 0;      for ($i = 0; $i < count($_POST["select"]); $i++)      {         $id_candidature = $_POST["select"][$i];        $date_modification = date("Y-m-d H:i");        $my_sql = mysql_query("SELECT status from candidature where id_candidature = '$id_candidature'");        $test = mysql_fetch_array($my_sql);        if($test['status'] == 'Cloturé')        {        mysql_query("DELETE from candidature where id_candidature = '$id_candidature'");        $deleted += mysql_affected_rows();        mysql_query("DELETE from historique where id_candidature = '$id_candidature'");               }        else        {         mysql_query("Update candidature SET status = 'Cloturé' where id_candidature = '$id_candidature'");        mysql_query("INSERT INTO historique VALUES ('$id_candidature','Non retenu','$date_modification','')");        $affected += mysql_affected_rows();        }             }      if($affected > 0)        echo $affected.' Candidature(s) non retenue(s).';      elseif($deleted > 0)        echo $deleted.' Candidature(s) supprimée(s).';    }  }  //*$l= rand(4, 8);function generateRandomString($length) {        $r = substr(str_shuffle("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"), 0, $length);      return $r; }$n_f=generateRandomString($l);//echo $n_f."<br>";if(isset($_POST['envoyer_emails'])){    ////////////////////////////////Récupération des données du formulaires///////////////////////////////      $m_email      = isset($_POST['m_email'])   ? $_POST['m_email']      : "";    $m_emails     = isset($_POST['m_emails'])  ? $_POST['m_emails']      : "";    $m_sujet      = isset($_POST['m_sujet'])   ? $_POST['m_sujet']      : "";    $m_message    = isset($_POST['m_message'])   ? $_POST['m_message']      : "";    $txt_msg    = "E-talent"; //----------------------------------------------------------------------------------------------------------------------$allowedExts = array("gif", "jpeg", "jpg", "png", "pdf", "doc", "docx");$temp = explode(".", $_FILES["piecejointe"]["name"]);$extension = end($temp);     $f_name_path = "" . __DIR__ . $file_courrier . $n_f .".". $extension;//echo $f_name_path."<br>";if (($_FILES["piecejointe"]["size"] < 2000000)&& in_array($extension, $allowedExts)) {  if ($_FILES["piecejointe"]["error"] > 0) {    echo "Return Code: " . $_FILES["piecejointe"]["error"] . "<br>";  } else {    if (file_exists("upload/" . $_FILES["piecejointe"]["name"])) {     // echo $_FILES["piecejointe"]["name"] . " already exists. ";    } else {      //move_uploaded_file($_FILES["piecejointe"]["tmp_name"], $f_name_path );      copy($_FILES["piecejointe"]["tmp_name"], $f_name_path );     // echo "Stored in: " . "upload/" . $_FILES["piecejointe"]["name"];    }  }      //  $_nomFichier = $_FILES['piecejointe']['name'];/* GET File Variables */     $tmpName = $_FILES['piecejointe']['tmp_name'];     $fileType = $_FILES['piecejointe']['type'];     $fileName = $_FILES['piecejointe']['name']; } else { // echo "Fichier non validé";} //------------------------------------------------------------------------------------------------------------------------- $m_emails=str_replace(' ','',$m_emails);$m_emails = rtrim($m_emails, ',');$emails_t  =explode(",", $m_emails);    foreach ($emails_t as &$email) {//==========//==========//==========//==========//if (!preg_match("#^[a-z0-9._-]+@(hotmail|live|msn).[a-z]{2,4}$#", $mail)) // On filtre les serveurs qui présentent des bogues.{  $passage_ligne = "\r\n";}else{  $passage_ligne = "\n";}//=====Déclaration des messages au format texte et au format HTML.$message_txt = $txt_msg;$message_html = $m_message  ;//========== //=====Lecture et mise en forme de la pièce jointe.if($fileName){$fichier   = fopen($tmpName, "r");$attachement = fread($fichier, filesize($tmpName));$attachement = chunk_split(base64_encode($attachement));fclose($fichier);}//========== //=====Création de la boundary.$boundary = "-----=".md5(rand());$boundary_alt = "-----=".md5(rand());//========== //=====Définition du sujet.$sujet = $m_sujet;//========= //=====Création du header de l'e-mail.$header = "From: ".$nom_site." <".$m_email.">".$passage_ligne;$header.= "Reply-to: \"Admin email\" <".$admin_email.">".$passage_ligne;$header.= "MIME-Version: 1.0".$passage_ligne;$header.= "Content-Type: multipart/mixed;".$passage_ligne." boundary=\"$boundary\"".$passage_ligne;//========== //=====Création du message.$message = $passage_ligne."--".$boundary.$passage_ligne;$message.= "Content-Type: multipart/alternative;".$passage_ligne." boundary=\"$boundary_alt\"".$passage_ligne;$message.= $passage_ligne."--".$boundary_alt.$passage_ligne;//=====Ajout du message au format texte.$message.= "Content-Type: text/plain; charset=\"utf-8\"".$passage_ligne;$message.= "Content-Transfer-Encoding: 8bit".$passage_ligne;$message.= $passage_ligne.$message_txt.$passage_ligne;//========== $message.= $passage_ligne."--".$boundary_alt.$passage_ligne; //=====Ajout du message au format HTML.$message.= "Content-Type: text/html; charset=\"utf-8\"".$passage_ligne;$message.= "Content-Transfer-Encoding: 8bit".$passage_ligne;$message.= $passage_ligne.$message_html.$passage_ligne;//========== //=====On ferme la boundary alternative.$message.= $passage_ligne."--".$boundary_alt."--".$passage_ligne;//==========   $message.= $passage_ligne."--".$boundary.$passage_ligne; //=====Ajout de la pièce jointe.$message.= "Content-Type: image/jpeg; name=\"".$fileName."\"".$passage_ligne;$message.= "Content-Transfer-Encoding: base64".$passage_ligne;$message.= "Content-Disposition: attachment; filename=\"".$fileName."\"".$passage_ligne;$message.= $passage_ligne.$attachement.$passage_ligne.$passage_ligne;$message.= $passage_ligne."--".$boundary."--".$passage_ligne; //========== //=====Envoi de l'e-mail.mail($mail,$sujet,$message,$header);//==========//==========//==========//==========//      }}                            if (isset($_GET['send'])) {                                $candidats = isset($_GET['select']) ? $_GET['select'] : "";                               $affected = 0;                                if (isset($_GET['select'])) {                                    for ($i = 0; $i < count($candidats); $i++) {                                        $id_candidat = $candidats[$i];                                        $selecCV = mysql_query("select * from cv  where candidats_id='$id_candidat'  AND principal=1 AND actif=1".$g_by2);                                        $councv = mysql_num_rows($selecCV);                                        $result_cv = mysql_fetch_array($selecCV);                                        if ($councv)                                            $id_cv = $result_cv['id_cv'];                                        else                                            $id_cv = 0;                                        $selectt = mysql_query("select * from archive_cvs where id_candidat='$id_candidat' ");                                        $count = mysql_num_rows($selectt);                                        if (!$count)                                            $insert = mysql_query("INSERT INTO archive_cvs VALUES ('1','$id_candidat','$id_cv')");                                        else                                            $insert = mysql_query("UPDATE  archive_cvs SET id_cv = $id_cv  where  id_candidat = '$id_candidat' ");                                        $affected += mysql_affected_rows();                                    }                                }                              if ($affected > 0)                                    echo '<h3>' . $affected . ' CV archivé(s) avec succès.</h3>';                               else                                    echo '<h3>0 CV archivé.</h3>';                            }                            ?><div class="subscription" style="margin: 10px 0pt;">                                <h1>Options de filtrage des CV </h1>                            </div><form action="<?php echo $_SERVER['REQUEST_URI']; ?>" method="post"><table  width="100%"><td  width="30%"><table width="100%" border="0"><tr><td colspan="2" >Par mot clé<label><br/><input  type="text" name="motcle" style="width:185px" value="<?php if (!empty($_SESSION["ch_motcle"])) echo $_SESSION["ch_motcle"]; ?>" maxlength="100" /></label></td></tr><tr><td colspan="2"><label>Par secteur d’activité</label><br />              <select name="secteur" >          <option value="" selected="selected" ></option>                        <?php                        $req_theme = mysql_query("SELECT * FROM prm_sectors");                        while ($data = mysql_fetch_array($req_theme)) {                        $Sector_id = $data['id_sect'];                        $Sector = $data['FR'];                        ?><option value="<?php echo $Sector_id; ?>" <?php if (isset($_SESSION["ch_secteur"]) and $_SESSION["ch_secteur"] == $Sector_id) echo ' selected="selected"'; ?>><?php echo $Sector; ?></option><?php                        }                        ?>          </select> </td></tr><tr><td><label>Par année d'expérience</label><br /><select name="exp">          <option value=""></option>                                                            <?php                                                            $req_exp = mysql_query("SELECT * FROM prm_experience");                                                            while ($exp = mysql_fetch_array($req_exp)) {                                                            $exp_id = $exp['id_expe'];                                                            $exp_desc = $exp['intitule'];                        ?><option value="<?php echo $exp_id; ?>" <?php if (isset($_SESSION["ch_exp"]) and $_SESSION["ch_exp"] == $exp_id) echo ' selected="selected"'; ?>><?php echo $exp_desc; ?></option><?php                                                            }                                                            ?>          </select></td></tr><tr>    <td>	<label>Par salaire souhaité en Dh </label> <br />        <select name="salaire">   <option value=""></option>   <?php   $req_salaire = mysql_query("SELECT * FROM prm_salaires");   while ($salaire = mysql_fetch_array($req_salaire)) {       $salaire_id = $salaire['id_salr'];       $salaire_desc = $salaire['salaire'];;                        ?><option value="<?php echo $salaire_id; ?>" <?php if (isset($_SESSION["ch_salaire"]) and $_SESSION["ch_salaire"] == $salaire_id) echo ' selected="selected"'; ?>><?php echo $salaire_desc; ?></option><?php   }   ?>        </select>		</td></tr></table></td><td  width="30%"><table><tr><td><label>Par niveau d'étude</label><br /> <select name="formation">            <option value="" selected="selected"></option>     <?php        $req_nf = mysql_query( "SELECT * FROM prm_niv_formation");            while ( $nf = mysql_fetch_array( $req_nf ) ) {                $nf_id = $nf['id_nfor'];                $nf_desc = $nf['formation'];                        ?><option value="<?php echo $nf_id; ?>" <?php if (isset($_SESSION["ch_formation"]) and $_SESSION["ch_formation"] == $nf_id) echo ' selected="selected"'; ?>><?php echo $nf_desc; ?></option><?php            }    ?>           </select> </td></tr><tr><td><label>Par fraicheur du CV</label><br /><select name="fraicheur" id="fraicheur"><option value=""></option><option value="30" <?php if (isset($_SESSION["ch_fraicheur"]) and $_SESSION["ch_fraicheur"] == "30") echo ' selected="selected"'; ?>>Moins de 1 mois</option><option value="90" <?php if (isset($_SESSION["ch_fraicheur"]) and $_SESSION["ch_fraicheur"] == "90") echo ' selected="selected"'; ?>>Moins de 3 mois</option><option value="180" <?php if (isset($_SESSION["ch_fraicheur"]) and $_SESSION["ch_fraicheur"] == "180") echo ' selected="selected"'; ?>>Moins de 6 mois</option><option value="360" <?php if (isset($_SESSION["ch_fraicheur"]) and $_SESSION["ch_fraicheur"] == "360") echo ' selected="selected"'; ?>>Moins de 12 mois</option></select></td></tr><tr><td colspan="3">        <label>Par école ou établissement</label><br /><select name="etablissement" >          <option value=""></option>                      <?php                       $select_ecole = mysql_query("SELECT * FROM prm_ecoles");                      while($ecole = mysql_fetch_array($select_ecole))                      {                        ?><option value="<?php echo $ecole['id_ecole']; ?>" <?php if (isset($_SESSION["ch_etablissement"]) and $_SESSION["ch_etablissement"] == $ecole['id_ecole']) echo ' selected="selected"'; ?>><?php echo $ecole['nom_ecole']; ?></option><?php                      }                              ?>           </select></td></tr><tr>    <td><label>Par disponibilité</label> <br />        <select name="dispo">   <option value="" selected="selected"> </option><?php 	$rf01 = mysql_query( " SELECT * FROM  prm_disponibilite  ");						while ( $f01 = mysql_fetch_array( $rf01 ) ) {										$fid01 = $f01['id_dispo'];		$fdesc01 = $f01['intitule'];		                        ?><option value="<?php echo $fid01; ?>" <?php if (isset($_SESSION["ch_dispo"]) and $_SESSION["ch_dispo"] == $fid01) echo ' selected="selected"'; ?>><?php echo $fdesc01; ?></option><?php}											  ?>         </select>    </td></tr></table></td>   <td  width="30%"> <table><tr><td> <label>Par situation actuelle</label><br /><select name="situation">            <option value=""></option>                        <?php                       $select_sa = mysql_query("SELECT * FROM prm_situation");                      while($sa = mysql_fetch_array($select_sa))                      {                        ?><option value="<?php echo $sa['id_situ']; ?>" <?php if (isset($_SESSION["ch_situation"]) and $_SESSION["ch_situation"] == $sa['id_situ']) echo ' selected="selected"'; ?>><?php echo $sa['situation']; ?></option><?php                      }                              ?>            </select>                    </td><td></td></tr><tr><td><label>Par type de formation</label><br />         <select name="type_formation" ><option value="" selected="selected"></option>      <?php       $select_tf = mysql_query("SELECT * FROM prm_type_formation");      while($tf = mysql_fetch_array($select_tf))      {                                ?><option value="<?php echo $tf['id_tfor']; ?>" <?php if (isset($_SESSION["ch_type_formation"]) and $_SESSION["ch_type_formation"] ==$tf['id_tfor']) echo ' selected="selected"'; ?>><?php echo $tf['formation']; ?></option><?php         }            ?> </select>  </td><td></td></tr><tr><td><label>Par pays de résidence</label><br />          <select name="pays">          <option value=""></option>         <?php            $req_pays = mysql_query( "SELECT * FROM prm_pays");                while ( $pays = mysql_fetch_array( $req_pays ) ) {                    $pays_id = $pays['id_pays'];                    $pays_desc = $pays['pays'];                         ?><option value="<?php echo $pays_id; ?>" <?php if (isset($_SESSION["ch_pays"]) and $_SESSION["ch_pays"] == $pays_id) echo ' selected="selected"'; ?>><?php echo $pays_desc; ?></option><?php                }        ?>          </select>           </td>    </tr>    </table>    </td>  </table><br>  <input type="submit" class="espace_candidat" name="envoi" value="Filtrer" /> <input type="submit" class="espace_candidat" name="actualiser" OnClick="javascript:window.location.reload()" value="Actualiser">	</form>        <?php         //if (isset($_POST['envoi'])) {   if (!empty($_SESSION["ch_motcle"]) || !empty($_SESSION["ch_fonction"]) || !empty($_SESSION["ch_fraicheur"]) || !empty($_SESSION["ch_pays"]) || !empty($_SESSION["ch_formation"]) || !empty($_SESSION["ch_type_formation"]) || !empty($_SESSION["ch_exp"]) || !empty($_SESSION["ch_secteur"]) || !empty($_SESSION["ch_situation"]) || !empty($_SESSION["ch_etablissement"]) || !empty($_SESSION["ch_salaire"]) || !empty($_SESSION["ch_dispo"]) || !empty($_SESSION["ch_datecv"]) ) {       $result = "";       if (!empty($_SESSION["ch_pays"])) $result .= "candidats.id_pays = '" . $_SESSION["ch_pays"] . "'";      if (!empty($_SESSION["ch_motcle"])) {          $lemotcle = '%' . $_SESSION["ch_motcle"] . '%';          if (empty($result)) $result .= "lower(concat_ws(' ',titre, formations.id_ecol,formations.diplome,formations.description,candidats.nom,candidats.email, candidats.prenom , CONCAT(candidats.prenom, ' ', candidats.nom))) like lower('%" . $_SESSION["ch_motcle"] . "%')"; else $result .= "And lower(concat_ws(' ',titre, formations.id_ecol,formations.diplome,formations.description, candidats.nom,candidats.email, candidats.prenom, CONCAT(candidats.prenom, ' ', candidats.nom))) like lower('%" . $_SESSION["ch_motcle"] . "%')";       }	   	if(!empty($_SESSION["ch_formation"]))	{if (empty($result)) $result .= "candidats.id_nfor = '" . $_SESSION["ch_formation"] . "'";else $result .= "And candidats.id_nfor = '" . $_SESSION["ch_formation"] . "'"; 			}if (!empty($_SESSION["ch_fonction"])) {if (empty($result)) $result .= "candidats.id_fonc  = '" . $_SESSION["ch_fonction"] . "'";else $result .= "And candidats.id_fonc  = '" . $_SESSION["ch_fonction"] . "'";       }if (!empty($_SESSION["ch_type_formation"])) {  if (empty($result)) $result .= "candidats.id_tfor = '" . $_SESSION["ch_type_formation"] . "'"; else $result .= "And candidats.id_tfor = '" . $_SESSION["ch_type_formation"] . "'";       }      if (!empty($_SESSION["ch_exp"])) { if (empty($result)) $result .= "candidats.id_expe = '" . $_SESSION["ch_exp"] . "'"; else $result .= "And candidats.id_expe = '" . $_SESSION["ch_exp"] . "'";       }       if (!empty($_SESSION["ch_secteur"])) { if (empty($result)) $result .= "candidats.id_sect = '" . addslashes($_SESSION["ch_secteur"]) . "'"; else $result .= "And candidats.id_sect = '" . addslashes($_SESSION["ch_secteur"]) . "'";       }      if (!empty($_SESSION["ch_situation"])) {          if (empty($result)) $result .= "candidats.id_situ  = '" . $_SESSION["ch_situation"] . "'"; else $result .= "And candidats.id_situ = '" . $_SESSION["ch_situation"] . "'";       }  if (!empty($_SESSION["ch_etablissement"])) {                        if (empty($result))  $result .= " formations.id_ecol = '" . $_SESSION["ch_etablissement"]  . "' ";                        else  $result .= " And formations.id_ecol = '" . $_SESSION["ch_etablissement"]  . "' ";                    }					  if (!empty($_SESSION["ch_salaire"])) {                        if (empty($result))  $result .= " candidats.id_salr = '" . $_SESSION["ch_salaire"]  . "' ";                        else  $result .= " And candidats.id_salr = '" . $_SESSION["ch_salaire"]  . "' ";                    }					  if (!empty($_SESSION["ch_dispo"])) {                        if (empty($result))  $result .= " candidats.id_dispo = '" . $_SESSION["ch_dispo"]  . "' ";                        else  $result .= " And candidats.id_dispo = '" . $_SESSION["ch_dispo"]  . "' ";                    }					  if (!empty($_SESSION["ch_datecv"])) {                        if (empty($result)) $result .= "DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_datecv"] . "'"; else $result .= "And DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_datecv"] . "'";                    }					       if (!empty($_SESSION["ch_fraicheur"])) { if (empty($result)) $result .= "DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_fraicheur"] . "'"; else $result .= "And DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_fraicheur"] . "'";       }      $select = mysql_query("select COUNT(*) from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id   INNER JOIN cv ON cv.candidats_id = candidats.candidats_id WHERE " . $result . " AND  cv.principal=1 AND cv.actif=1".$g_by);   }   else {       //$select = mysql_query("select COUNT(*) from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id  INNER JOIN cv ON cv.candidats_id = candidats.candidats_id WHERE  cv.principal=1 AND cv.actif=1".$g_by);       $select = mysql_query("select COUNT(*) from  candidats   ".$g_by);	   }/*	       }         else {   //$select = mysql_query("select COUNT(*) from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id  INNER JOIN cv ON cv.candidats_id = candidats.candidats_id WHERE  cv.principal=1 AND cv.actif=1".$g_by);   $select = mysql_query("select COUNT(*) from  candidats  ".$g_by);   }   //*/         $count = mysql_num_rows($select);         $nbItems = mysql_fetch_array($select);        $nbItems = $nbItems[0];         $itemsParPage = 10000;$nbPages = $nbItems / $itemsParPage;if (!isset($_POST['idPage'])) {   $pageCourante = 1;         } else {   if (is_numeric($_POST['idPage']) && $_POST['idPage'] <= $nbPages)       $pageCourante = $_POST['idPage'];   else       $pageCourante = $nbPages;         }         //Calcul de la clause LIMIT        $limitstart = $pageCourante * $itemsParPage - $itemsParPage;//         if (isset($_POST['envoi'])) {   $_session['formation'] = '';   if (!empty($_SESSION["ch_motcle"]) || !empty($_SESSION["ch_fonction"]) || !empty($_SESSION["ch_fraicheur"]) || !empty($_SESSION["ch_pays"]) || !empty($_SESSION["ch_formation"]) || !empty($_SESSION["ch_type_formation"]) || !empty($_SESSION["ch_exp"]) || !empty($_SESSION["ch_secteur"]) || !empty($_SESSION["ch_situation"]) || !empty($_SESSION["ch_etablissement"]) || !empty($_SESSION["ch_salaire"]) || !empty($_SESSION["ch_dispo"]) || !empty($_SESSION["ch_datecv"]) ) {$requete = ""; if (!empty($_SESSION["ch_pays"])) $requete .= "candidats.id_pays = '" . $_SESSION["ch_pays"] . "'"; if (!empty($_SESSION["ch_motcle"])) {if (empty($requete)) $requete .= "lower(concat_ws(' ',titre, formations.id_ecol,formations.diplome,formations.description, candidats.nom,candidats.email, candidats.prenom, CONCAT(candidats.prenom, ' ', candidats.nom))) like lower('%" . $_SESSION["ch_motcle"] . "%')";else $requete .= "And lower(concat_ws(' ',titre, formations.id_ecol,formations.diplome,formations.description, candidats.nom,candidats.email, candidats.prenom, CONCAT(candidats.prenom, ' ', candidats.nom))) like lower('%" . $_SESSION["ch_motcle"] . "%')";       }      if (!empty($_SESSION["ch_formation"])) { if (empty($requete)) $requete .= "candidats.id_nfor = '" . $_SESSION["ch_formation"] . "'";else $requete .= "And candidats.id_nfor = '" . $_SESSION["ch_formation"] . "'";       }       if (!empty($_SESSION["ch_fonction"])) {if (empty($requete)) $requete .= "candidats.id_fonc  = '" . $_SESSION["ch_fonction"] . "'";else $requete .= "And candidats.id_fonc  = '" . $_SESSION["ch_fonction"] . "'";       }if (!empty($_SESSION["ch_type_formation"])) { if (empty($requete)) $requete .= "candidats.id_tfor = '" . $_SESSION["ch_type_formation"]. "'";else $requete .= "And candidats.id_tfor = '" . $_SESSION["ch_type_formation"] . "'";       }       if (!empty($_SESSION["ch_exp"])) { if (empty($requete))    $requete .= "candidats.id_expe = '" . $_SESSION["ch_exp"] . "'";else    $requete .= "And candidats.id_expe = '" . $_SESSION["ch_exp"] . "'";}if (!empty($_SESSION["ch_secteur"])) {    if (empty($requete))        $requete .= "candidats.id_sect = '" . addslashes($_SESSION["ch_secteur"]) . "'";    else$requete .= "And candidats.id_sect = '" . addslashes($_SESSION["ch_secteur"]) . "'";}if (!empty($_SESSION["ch_situation"])) {if (empty($requete))    $requete .= "candidats.id_situ = '" . $_SESSION["ch_situation"] . "'";else    $requete .= "And candidats.id_situ = '" . $_SESSION["ch_situation"] . "'";       }                    if (!empty($_SESSION["ch_etablissement"])) {                        if (empty($requete))  $requete .= " formations.id_ecol = '" . $_SESSION["ch_etablissement"]  . "' ";                        else  $requete .= " And formations.id_ecol = '" . $_SESSION["ch_etablissement"]  . "' ";                    }										  if (!empty($_SESSION["ch_salaire"])) {                        if (empty($requete))  $requete .= " candidats.id_salr = '" . $_SESSION["ch_salaire"]  . "' ";                        else  $requete .= " And candidats.id_salr = '" . $_SESSION["ch_salaire"]  . "' ";                    }					  if (!empty($_SESSION["ch_dispo"])) {                        if (empty($requete))  $requete .= " candidats.id_dispo = '" . $_SESSION["ch_dispo"]  . "' ";                        else  $requete .= " And candidats.id_dispo = '" . $_SESSION["ch_dispo"]  . "' ";                    }					  if (!empty($_SESSION["ch_datecv"])) {                        if (empty($requete)) $requete .= "DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_datecv"] . "'"; else $requete .= "And DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_datecv"] . "'";                    }					if (!empty($_SESSION["ch_fraicheur"])) {if (empty($requete))$requete .= "DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_fraicheur"] . "'";else$requete .= "And DATEDIFF(curdate(),CVdateMAJ)<'" . $_SESSION["ch_fraicheur"] . "'";}$selectString = "select * from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id  INNER JOIN cv ON cv.candidats_id = candidats.candidats_id WHERE " . $requete . " AND  cv.principal=1 AND cv.actif=1 ".$g_by."  order by dateMAJ desc ";//LIMIT " . $limitstart . "," . $itemsParPage . "}else {//$selectString = "select * from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id  INNER JOIN cv ON cv.candidats_id = candidats.candidats_id WHERE   cv.principal=1 AND cv.actif=1  ".$g_by."  order by dateMAJ desc LIMIT " . $limitstart . "," . $itemsParPage . " ";$selectString = "select * from  candidats     ".$g_by."  order by dateMAJ desc "; //LIMIT " . $limitstart . "," . $itemsParPage . "}/*}else {//$selectString = "select * from  candidats  INNER JOIN formations ON candidats.candidats_id = formations.candidats_id  INNER JOIN cv ON cv.candidats_id = candidats.candidats_id  WHERE   cv.principal=1 AND cv.actif=1  ".$g_by."  order by dateMAJ desc LIMIT " . $limitstart . "," . $itemsParPage . "";$selectString = "select * from  candidats     ".$g_by."  order by dateMAJ desc ";// LIMIT " . $limitstart . "," . $itemsParPage . "}//*///echo "<br>".$selectString."<br>";?><div class="subscription" style="margin: 10px 0pt;"><h1>CV des candidats  </h1></div><?phpinclude("./canadidats_historique_m_table.php");   //Système de pagination ?>                  